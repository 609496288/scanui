webpackJsonp([6],{122:function(t,e,a){var i=a(3)(a(651),a(652),null,null);t.exports=i.exports},294:function(t,e,a){a(592);var i=a(3)(a(593),a(594),null,null);t.exports=i.exports},592:function(t,e){},593:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});
//!/usr/bin/env nodejs
var i=function(t,e,a,i){return e("i-button",{props:{type:a.editting?"success":"primary",loading:a.saving,size:"small"},style:{margin:"0 5px"},on:{click:function(){if(a.editting){t.edittingStore[i].saving=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore));var e=t.edittingStore[i];e.editting=!1,e.saving=!1,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore)),t.$emit("input",t.handleBackdata(t.thisTableData)),t.$emit("on-change",t.handleBackdata(t.thisTableData),i)}else{if(a.edittingCell)for(var s in a.edittingCell)a.edittingCell[s]=!1,t.edittingStore[i].edittingCell[s]=!1;t.edittingStore[i].editting=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore))}}}},a.editting?"保存":"编辑")},s=function(t,e,a,i){return e("Poptip",{props:{confirm:!0,title:"您确定要删除这条数据吗?",transfer:!0,placement:"left"},on:{"on-ok":function(){t.thisTableData.splice(i,1),t.$emit("input",t.handleBackdata(t.thisTableData)),t.$emit("on-delete",t.handleBackdata(t.thisTableData),i)}}},[e("i-button",{style:{margin:"0 5px"},props:{type:"error",placement:"top",size:"small"}},"删除")])},n=function(t,e,a){return t.hoverShow?e("div",{class:{"show-edit-btn":t.hoverShow}},[e("i-button",{props:{type:"text",icon:"edit"},on:{click:function(e){t.edittingStore[a.index].edittingCell[a.column.key]=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore))}}})]):e("i-button",{props:{type:"text",icon:"edit"},on:{click:function(e){t.edittingStore[a.index].edittingCell[a.column.key]=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore))}}})},o=function(t,e,a){return e("i-button",{props:{type:"text",icon:"checkmark"},on:{click:function(e){t.edittingStore[a.index].edittingCell[a.column.key]=!1,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore)),t.$emit("input",t.handleBackdata(t.thisTableData)),t.$emit("on-cell-change",t.handleBackdata(t.thisTableData),a.index,a.column.key)}}})},r=function(t,e,a,i){return e("Input",{props:{type:"text",value:t.edittingStore[a.index][i.key]},on:{"on-change":function(e){var s=i.key;t.edittingStore[a.index][s]=e.target.value}}})};e.default={name:"canEditTable",props:{refs:String,columnsList:Array,value:Array,url:String,editIncell:{type:Boolean,default:!1},hoverShow:{type:Boolean,default:!1}},data:function(){return{columns:[],thisTableData:[],edittingStore:[]}},created:function(){this.init()},methods:{init:function(){var t=this,e=this,a=this.columnsList.filter(function(t){if(t.editable&&!0===t.editable)return t}),l=JSON.parse(JSON.stringify(this.value)),c=[];c=l.map(function(e,i){var s=!1;if(t.thisTableData[i])if(t.thisTableData[i].editting)s=!0;else for(var n in t.thisTableData[i].edittingCell)!0===t.thisTableData[i].edittingCell[n]&&(s=!0);if(s)return t.thisTableData[i];t.$set(e,"editting",!1);var o={};return a.forEach(function(t){o[t.key]=!1}),t.$set(e,"edittingCell",o),e}),this.thisTableData=c,this.edittingStore=JSON.parse(JSON.stringify(this.thisTableData)),this.columnsList.forEach(function(a){a.editable&&(a.render=function(i,s){var l=t.thisTableData[s.index];return l.editting?i("Input",{props:{type:"text",value:l[a.key]},on:{"on-change":function(t){var a=s.column.key;e.edittingStore[s.index][a]=t.target.value}}}):t.editIncell?i("Row",{props:{type:"flex",align:"middle",justify:"center"}},[i("Col",{props:{span:"22"}},[l.edittingCell[s.column.key]?r(t,i,s,a):i("span",l[a.key])]),i("Col",{props:{span:"2"}},[l.edittingCell[s.column.key]?o(t,i,s):n(t,i,s)])]):i("span",l[a.key])}),a.handle&&(a.render=function(e,n){var o=t.thisTableData[n.index],r=[];return a.handle.forEach(function(a){"edit"===a?r.push(i(t,e,o,n.index)):"delete"===a&&r.push(s(t,e,0,n.index))}),e("div",r)})})},handleBackdata:function(t){var e=JSON.parse(JSON.stringify(t));return e.forEach(function(t){delete t.editting,delete t.edittingCell,delete t.saving}),e}},watch:{value:function(t){this.init()}}}},594:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Table",{ref:t.refs,attrs:{stripe:"",border:"",size:"small",columns:t.columnsList,data:t.thisTableData}})],1)},staticRenderFns:[]}},651:function(t,e,a){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=a(6),n=i(s),o=a(294),r=i(o);
//!/usr/bin/env nodejs
e.default={name:"task-table",components:{canEditTable:r.default},data:function(){var t=this;return{modalinfo:!1,scaninfo:!1,projectname:sessionStorage.projectname,projectid:sessionStorage.projectid,current:1,total:100,searchdata:"",taskinfoview:{buglist:[],hostlist:[]},tasklist:[],tasktype:[],tasknode:[],taskinfo:{task_host:"",task_note:"",task_level:"3",task_name:"",task_args:"",task_node:[],isfilter:!1,isverify:!1,block:""},taskdata:[],taskcol:[{type:"selection",width:50,align:"center"},{title:"任务状态",align:"center",width:120,key:"task_code",sortable:!0,render:function(t,e){var a=e.row.task_code,i="waiting"===a?"等待运行":"PENDING"===a?"队列中":"working"===a?"运行中":"finish"===a?"已完成":a;return t("Tag",{props:{checkable:!0,color:"waiting"===a?"default":"PENDING"===a?"green":"working"===a?"yellow":"finish"===a?"blue":"red"}},i)}},{title:"任务目标",key:"task_host"},{title:"任务类型",key:"task_name",ellipsis:"true",render:function(t,e){return t("div",{},e.row.task_name+" "+e.row.task_args)}},{title:"创建时间",align:"center",key:"createdate",sortable:!0,width:120,render:function(t,e){return t("span",[t("Icon",{props:{type:"android-time"}}),t("span",n.default.formatdate(e.row.createdate))])}},{title:"操作",align:"center",width:100,key:"action",render:function(e,a){return e("div",[e("Button",{props:{type:"info"},on:{click:function(){t.scantaskinfoview(a.row.task_id)}}},"详情")])}}],hostcol:[{title:"状态",align:"center",width:80,key:"status",sortable:!0,render:function(t,e){var a=e.row.status,i="insert"===a?"新增":"update"===a?"更新":"delete"===a?"删除":a;return t("Tag",{props:{checkable:!0,color:"insert"===a?"red":"update"===a?"yellow":"delete"===a?"default":"blue"}},i)}},{title:"地址",align:"center",key:"host",width:140,sortable:!0},{title:"端口",align:"center",key:"port",width:80,sortable:!0,editable:!0},{title:"服务",align:"center",key:"service",width:120,editable:!0},{title:"版本",align:"center",key:"softver",editable:!0},{title:"操作",align:"center",width:120,key:"action",render:function(e,a){return e("div",[e("Button",{props:{type:"info",size:"small"},on:{click:function(){t.taskinfoverify(a.row.hostid)}}},"入库"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.taskinfofinish(a.row.hostid)}}},"删除")])}}],showCurrentTableData:!0}},methods:{scantaskinfoview:function(t){var e=this;n.default.ajax({method:"POST",action:"scanntaskinfo",json:{taskid:t}}).then(function(t){e.taskinfoview=t,e.scaninfo=!0}).catch(function(t){e.$Message.error(t)})},tasktypeget:function(t){var e=this;n.default.ajax({method:"POST",action:"tasktypeget",json:{page:t}}).then(function(t){e.tasktype=t}).catch(function(t){e.$Message.error(t)})},tasknodeget:function(t){var e=this;n.default.ajax({method:"POST",action:"tasknodeget",json:{keyword:t}}).then(function(t){e.tasknode=t}).catch(function(t){e.$Message.error(t)})},scantasksearch:function(t){var e=this;n.default.ajax({method:"POST",action:"scantasksearch",json:{page:t,keyword:this.searchdata}}).then(function(t){e.taskdata=t.ret,e.total=t.total}).catch(function(t){e.$Message.error(t)})},scantaskfinish:function(){var t=this,e=this.$refs.selection.getSelection();this.tasklist=[];for(var a in e){this.tasklist.push(e[a].task_id);for(var i in this.taskdata)e[a].task_id==this.taskdata[i].task_id&&this.taskdata.splice(i,1)}n.default.ajax({method:"POST",action:"scantaskfinish",json:{selectlist:this.tasklist}}).then(function(e){t.$Message.info("删除成功！"),t.scantasksearch(1)}).catch(function(e){t.$Message.error(e)})},scantaskadd:function(){var t=this,e={};e.block=this.taskinfo.block.replace(/^\s+|\s+$/g,"").split("\n"),e.isfilter=this.taskinfo.isfilter,e.isverify=this.taskinfo.isverify,this.taskinfo.task_args.replace(/^\s+|\s+$/g,"").split(" ").forEach(function(t){var a=t.split("=");e[a[0].substr(1)]=a[1]}),n.default.ajax({method:"POST",action:"scantaskadd",json:{task_host:this.taskinfo.task_host,task_name:[this.taskinfo.task_name],task_level:this.taskinfo.task_level,task_args:e,task_note:this.taskinfo.task_note,task_node:this.taskinfo.task_node}}).then(function(e){t.$Message.info("添加成功！"),t.scantasksearch(1)}).catch(function(e){t.$Message.error(e)})},selecttask:function(t){var e=this;sessionStorage.taskid=t,n.default.ajax({method:"POST",action:"scantaskselect",json:{taskid:t}}).then(function(t){sessionStorage.taskid=t.taskid,e.$Message.info("确定选择该任务")}).catch(function(t){e.$Message.error(t)})},uploadsuccess:function(t,e){this.taskinfo.task_host+=t.fid+"\n",this.taskinfo.task_note=t.fname,this.taskinfo.task_name=["hashbrute"]},rands:function(){var t=["red","blue","yellow","green"];return t[Math.floor(Math.random()*t.length)]},gotaskdiff:function(t){this.$router.push({name:"task_diff",query:{tidb:t}})},taskinfoverify:function(t){var e=this;n.default.ajax({method:"POST",action:"taskinfoferify",json:{hostids:[t]}}).then(function(a){e.$Message.info("审核成功");for(var i in e.taskinfoview.hostlist)t==e.taskinfoview.hostlist[i].hostid&&e.taskinfoview.hostlist.splice(i,1)}).catch(function(t){e.$Message.error(t)})},taskinfofinish:function(t){var e=this;n.default.ajax({method:"POST",action:"taskinfofinish",json:{hostids:[t]}}).then(function(a){e.$Message.info("审核成功");for(var i in e.taskinfoview.hostlist)t==e.taskinfoview.hostlist[i].hostid&&e.taskinfoview.hostlist.splice(i,1)}).catch(function(t){e.$Message.error(t)})},reload:function(){this.taskinfo.task_host=this.taskinfoview.taskhost,this.taskinfo.task_name=this.taskinfoview.tasktype,this.taskinfo.task_node=[this.taskinfoview.tasknode],this.taskinfo.task_level=this.taskinfoview.tasklevel,this.taskinfo.task_note=this.taskinfoview.tasknote;var t=JSON.parse(this.taskinfoview.taskargs),e="";for(var a in t)"isfilter"==a?this.taskinfo.isfilter=t.isfilter:"isverify"==a?this.taskinfo.isverify=t.isverify:"block"==a?this.taskinfo.block=t.block.join("\n"):e+="-"+a+"="+t[a];this.taskinfo.task_args=e,this.scaninfo=!1,this.modalinfo=!0}},created:function(){if(this.tasktypeget(),"null"!=sessionStorage.projectid&&void 0!=sessionStorage.projectid?this.scantasksearch(1):(this.$Message.error("请先选择当前系统"),this.$router.push({name:"project_index"})),this.$route.params.isadd)return this.taskinfo=this.$route.params.taskinfo,this.modalinfo=!0}}},652:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",[a("Dropdown",{staticStyle:{"margin-left":"20px"}},[a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.modalinfo=!0}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),t._v("\n                    新建任务\n                ")],1)],1),t._v(" "),a("Poptip",{attrs:{confirm:"",placement:"bottom",title:"确认删除？"},on:{"on-ok":t.scantaskfinish}},[a("Button",{attrs:{type:"error",size:"large"}},[a("Icon",{attrs:{type:"ios-download-outline"}}),t._v("\n                    删除任务\n                ")],1)],1),t._v(" "),a("Input",{staticStyle:{width:"300px"},attrs:{slot:"extra",icon:"search",placeholder:"请输入任务目标进行搜索..."},on:{"on-click":function(e){t.scantasksearch(1)}},nativeOn:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.scantasksearch(1)}},slot:"extra",model:{value:t.searchdata,callback:function(e){t.searchdata=e},expression:"searchdata"}})],1),t._v(" "),a("Table",{ref:"selection",attrs:{stripe:"",border:"",columns:t.taskcol,data:t.taskdata}}),t._v(" "),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"left"}},[t._v("共 "+t._s(t.total)+" 条")]),t._v(" "),a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{"show-elevator":"",current:t.current,total:t.total,"page-size":50},on:{"on-change":t.scantasksearch}})],1)]),t._v(" "),a("Modal",{attrs:{title:t.projectname,styles:{top:"30px"},okText:"保存"},on:{"on-ok":t.scantaskadd},model:{value:t.modalinfo,callback:function(e){t.modalinfo=e},expression:"modalinfo"}},[a("Form",{attrs:{model:t.taskinfo,"label-width":80}},[a("Tabs",[a("TabPane",{attrs:{label:"参数"}},[a("FormItem",{attrs:{label:"扫描目标"}},[a("Input",{attrs:{rows:6,type:"textarea",placeholder:"一行一个目标网址,IP支持.1/24形式的C段简写"},model:{value:t.taskinfo.task_host,callback:function(e){t.$set(t.taskinfo,"task_host",e)},expression:"taskinfo.task_host"}})],1),t._v(" "),a("FormItem",{attrs:{label:"扫描类型"}},[a("RadioGroup",{model:{value:t.taskinfo.task_name,callback:function(e){t.$set(t.taskinfo,"task_name",e)},expression:"taskinfo.task_name"}},t._l(t.tasktype,function(e){return a("Tag",{attrs:{type:"border",color:"yellow"}},[a("Radio",{attrs:{label:e.task_name}},[t._v(t._s(e.task_desc))])],1)}))],1)],1),t._v(" "),a("TabPane",{attrs:{label:"选项"}},[a("FormItem",{attrs:{label:"入库设置"}},[a("Checkbox",{model:{value:t.taskinfo.isverify,callback:function(e){t.$set(t.taskinfo,"isverify",e)},expression:"taskinfo.isverify"}},[t._v("\n                                扫描结果是否经过人工审核再写入数据库\n                            ")])],1),t._v(" "),a("FormItem",{attrs:{label:"任务节点"}},[a("Select",{attrs:{multiple:"",clearable:"",filterable:"",remote:"","remote-method":t.tasknodeget},model:{value:t.taskinfo.task_node,callback:function(e){t.$set(t.taskinfo,"task_node",e)},expression:"taskinfo.task_node"}},t._l(t.tasknode,function(e){return a("Option",{key:e.nodeid,attrs:{value:e.nodeid}},[t._v(t._s(e.nodeid))])}))],1),a("FormItem",{attrs:{label:"任务等级"}},[a("Select",{model:{value:t.taskinfo.task_level,callback:function(e){t.$set(t.taskinfo,"task_level",e)},expression:"taskinfo.task_level"}},[a("Option",{attrs:{value:"0"}},[t._v("立刻")]),t._v(" "),a("Option",{attrs:{value:"1"}},[t._v("紧急")]),t._v(" "),a("Option",{attrs:{value:"2"}},[t._v("优先")]),t._v(" "),a("Option",{attrs:{value:"3"}},[t._v("一般")])],1)],1),a("FormItem",{attrs:{label:"任务参数"}},[a("Input",{attrs:{type:"text",placeholder:"-key1=value -key2=value"},model:{value:t.taskinfo.task_args,callback:function(e){t.$set(t.taskinfo,"task_args",e)},expression:"taskinfo.task_args"}})],1),t._v(" "),a("FormItem",{attrs:{label:"任务备注"}},[a("Input",{attrs:{type:"text"},model:{value:t.taskinfo.task_note,callback:function(e){t.$set(t.taskinfo,"task_note",e)},expression:"taskinfo.task_note"}})],1)],1),t._v(" "),a("TabPane",{attrs:{label:"黑名单"}},[a("FormItem",{attrs:{label:"黑名单"}},[a("Input",{attrs:{rows:6,type:"textarea",placeholder:"一行一个目标地址"},model:{value:t.taskinfo.block,callback:function(e){t.$set(t.taskinfo,"block",e)},expression:"taskinfo.block"}})],1),t._v(" "),a("FormItem",{attrs:{label:"过滤资产"}},[a("Checkbox",{model:{value:t.taskinfo.isfilter,callback:function(e){t.$set(t.taskinfo,"isfilter",e)},expression:"taskinfo.isfilter"}},[t._v("\n                            是否过滤重复资产\n                        ")])],1)],1)],1)],1)],1),t._v(" "),a("Modal",{attrs:{title:"任务详情",styles:{top:"30px"},scrollable:!0,width:"860"},model:{value:t.scaninfo,callback:function(e){t.scaninfo=e},expression:"scaninfo"}},[a("div",["finish"==t.taskinfoview.taskcode?a("Button",{attrs:{type:"primary"},on:{click:function(e){t.reload(t.taskinfoview.taskid)}}},[t._v("重载")]):"working"==t.taskinfoview.taskcode?a("Button",{attrs:{type:"error",click:""}},[t._v("结束")]):t._e(),t._v(" "),a("Button",{attrs:{type:"warning"},on:{click:function(e){t.gotaskdiff(t.taskinfoview.taskid)}}},[t._v("任务对比")])],1),t._v(" "),a("Row",[a("Col",{attrs:{lg:10}},[a("ul",[t._v("创建时间 : "+t._s(t.taskinfoview.createdate))]),t._v(" "),a("ul",[t._v("结束时间 : "+t._s(t.taskinfoview.finishdate))]),t._v(" "),a("ul",[t._v("任务状态 : "+t._s(t.taskinfoview.taskcode))]),t._v(" "),a("ul",[t._v("任务进程 : "+t._s(t.taskinfoview.taskpid))]),t._v(" "),a("ul",[t._v("任务等级 : "+t._s(t.taskinfoview.tasklevel))]),t._v(" "),a("ul",[t._v("任务备注 : "+t._s(t.taskinfoview.tasknote))])]),a("Col",{attrs:{lg:14}},[a("ul",[t._v("任务标识 : "+t._s(t.taskinfoview.taskid))]),t._v(" "),a("ul",[t._v("任务类型 : "+t._s(t.taskinfoview.tasktype))]),t._v(" "),a("ul",[t._v("任务名称 : "+t._s(t.taskinfoview.taskname))]),t._v(" "),a("ul",[t._v("任务主机 : "+t._s(t.taskinfoview.taskhost))]),t._v(" "),a("ul",[t._v("任务节点 : "+t._s(t.taskinfoview.tasknode))])]),t._v(" "),a("div",[t._v("任务参数 : "+t._s(t.taskinfoview.taskargs))])],1),t._v(" "),t.taskinfoview.buglist.length>0?a("Card",{attrs:{"dis-hover":""}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-list"}}),t._v("\n                    扫描漏洞结果\n                ")],1),t._v(" "),a("div",{staticStyle:{height:"250px","overflow-y":"hidden","overflow-x":"hidden"}},[a("ul",{staticClass:"iview-admin-draggable-list",attrs:{id:"todoList"}},t._l(t.taskinfoview.buglist,function(e){return a("a",{attrs:{href:"/#/buginfo?id="+e.bugid}},[a("li",{staticClass:"notwrap todolist-item"},[t._v("【"+t._s(e.bugrank)+"】"+t._s(e.bugname))])])}))])]):t._e(),t._v(" "),t.taskinfoview.hostlist.length>0?a("Table",{ref:"selectionhost",attrs:{stripe:"",border:"",size:"small",columns:t.hostcol,data:t.taskinfoview.hostlist}}):t._e()],1)],1)},staticRenderFns:[]}}});