webpackJsonp([3],{119:function(t,e,n){n(640);var i=n(3)(n(641),n(646),null,null);t.exports=i.exports},294:function(t,e,n){n(592);var i=n(3)(n(593),n(594),null,null);t.exports=i.exports},592:function(t,e){},593:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});
//!/usr/bin/env nodejs
var i=function(t,e,n,i){return e("i-button",{props:{type:n.editting?"success":"primary",loading:n.saving,size:"small"},style:{margin:"0 5px"},on:{click:function(){if(n.editting){t.edittingStore[i].saving=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore));var e=t.edittingStore[i];e.editting=!1,e.saving=!1,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore)),t.$emit("input",t.handleBackdata(t.thisTableData)),t.$emit("on-change",t.handleBackdata(t.thisTableData),i)}else{if(n.edittingCell)for(var a in n.edittingCell)n.edittingCell[a]=!1,t.edittingStore[i].edittingCell[a]=!1;t.edittingStore[i].editting=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore))}}}},n.editting?"保存":"编辑")},a=function(t,e,n,i){return e("Poptip",{props:{confirm:!0,title:"您确定要删除这条数据吗?",transfer:!0,placement:"left"},on:{"on-ok":function(){t.thisTableData.splice(i,1),t.$emit("input",t.handleBackdata(t.thisTableData)),t.$emit("on-delete",t.handleBackdata(t.thisTableData),i)}}},[e("i-button",{style:{margin:"0 5px"},props:{type:"error",placement:"top",size:"small"}},"删除")])},o=function(t,e,n){return t.hoverShow?e("div",{class:{"show-edit-btn":t.hoverShow}},[e("i-button",{props:{type:"text",icon:"edit"},on:{click:function(e){t.edittingStore[n.index].edittingCell[n.column.key]=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore))}}})]):e("i-button",{props:{type:"text",icon:"edit"},on:{click:function(e){t.edittingStore[n.index].edittingCell[n.column.key]=!0,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore))}}})},s=function(t,e,n){return e("i-button",{props:{type:"text",icon:"checkmark"},on:{click:function(e){t.edittingStore[n.index].edittingCell[n.column.key]=!1,t.thisTableData=JSON.parse(JSON.stringify(t.edittingStore)),t.$emit("input",t.handleBackdata(t.thisTableData)),t.$emit("on-cell-change",t.handleBackdata(t.thisTableData),n.index,n.column.key)}}})},r=function(t,e,n,i){return e("Input",{props:{type:"text",value:t.edittingStore[n.index][i.key]},on:{"on-change":function(e){var a=i.key;t.edittingStore[n.index][a]=e.target.value}}})};e.default={name:"canEditTable",props:{refs:String,columnsList:Array,value:Array,url:String,editIncell:{type:Boolean,default:!1},hoverShow:{type:Boolean,default:!1}},data:function(){return{columns:[],thisTableData:[],edittingStore:[]}},created:function(){this.init()},methods:{init:function(){var t=this,e=this,n=this.columnsList.filter(function(t){if(t.editable&&!0===t.editable)return t}),l=JSON.parse(JSON.stringify(this.value)),d=[];d=l.map(function(e,i){var a=!1;if(t.thisTableData[i])if(t.thisTableData[i].editting)a=!0;else for(var o in t.thisTableData[i].edittingCell)!0===t.thisTableData[i].edittingCell[o]&&(a=!0);if(a)return t.thisTableData[i];t.$set(e,"editting",!1);var s={};return n.forEach(function(t){s[t.key]=!1}),t.$set(e,"edittingCell",s),e}),this.thisTableData=d,this.edittingStore=JSON.parse(JSON.stringify(this.thisTableData)),this.columnsList.forEach(function(n){n.editable&&(n.render=function(i,a){var l=t.thisTableData[a.index];return l.editting?i("Input",{props:{type:"text",value:l[n.key]},on:{"on-change":function(t){var n=a.column.key;e.edittingStore[a.index][n]=t.target.value}}}):t.editIncell?i("Row",{props:{type:"flex",align:"middle",justify:"center"}},[i("Col",{props:{span:"22"}},[l.edittingCell[a.column.key]?r(t,i,a,n):i("span",l[n.key])]),i("Col",{props:{span:"2"}},[l.edittingCell[a.column.key]?s(t,i,a):o(t,i,a)])]):i("span",l[n.key])}),n.handle&&(n.render=function(e,o){var s=t.thisTableData[o.index],r=[];return n.handle.forEach(function(n){"edit"===n?r.push(i(t,e,s,o.index)):"delete"===n&&r.push(a(t,e,0,o.index))}),e("div",r)})})},handleBackdata:function(t){var e=JSON.parse(JSON.stringify(t));return e.forEach(function(t){delete t.editting,delete t.edittingCell,delete t.saving}),e}},watch:{value:function(t){this.init()}}}},594:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Table",{ref:t.refs,attrs:{stripe:"",border:"",size:"small",columns:t.columnsList,data:t.thisTableData}})],1)},staticRenderFns:[]}},640:function(t,e){},641:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(6),o=i(a),s=n(642),r=i(s),l=n(294),d=i(l);e.default={name:"hosts-table",components:{tableExpand:r.default,canEditTable:d.default},data:function(){var t=this;return{current:1,total:100,modalinfo:!1,modalimhost:!1,projectname:sessionStorage.projectname,projectid:sessionStorage.projectid,searchdata:"",addinfo:{hostip:"",hostport:"",hostname:"",osver:"",service:"",softver:"",note:""},taskinfo:[],hostdata:[],hosttemp:[],hostcol:[{type:"expand",width:30,align:"left",render:function(t,e){return t(r.default,{props:{hostid:e.row.hostid,hostip:e.row.hostip}})}},{title:"IP地址",align:"center",key:"hostip",sortable:!0,render:function(e,n){return e("span",[e("Button",{props:{shape:"circle",icon:"reply",size:"small"},on:{click:function(){t.taskadd(n.row.hostip)}}}),e("span",n.row.hostip)])}},{title:"主机名字",align:"center",key:"hostname",editable:!0},{title:"系统版本",align:"center",key:"osver",editable:!0},{title:"备注",align:"center",key:"note",editable:!0},{title:"操作",width:180,fixed:"right",key:"handle",handle:["edit","delete"]}],showCurrentTableData:!0}},methods:{hostsearch:function(t){var e=this;o.default.ajax({method:"POST",action:"hostsearch",json:{page:t,keyword:this.searchdata}}).then(function(t){e.hostdata=t.ret,e.hosttemp=t.ret,e.total=t.total}).catch(function(t){e.$Message.error(t)})},hostedit:function(t,e){var n=this;o.default.ajax({method:"POST",action:"hostedit",json:this.hostdata[e]}).then(function(t){n.$Message.info(t+"更新成功")}).catch(function(t){n.$Message.error(t)})},hostfinish:function(t,e){var n=this;o.default.ajax({method:"POST",action:"hostfinish",json:{hostid:this.hosttemp[e].hostid}}).then(function(e){n.$Message.info("删除成功！"),n.hosttemp=t}).catch(function(t){n.$Message.error(t)})},portadd:function(){var t=this;o.default.ajax({method:"POST",action:"portadd",json:this.addinfo}).then(function(e){t.$Message.info("增加成功！"),t.hostsearch(1)}).catch(function(e){t.$Message.error(e)})},taskadd:function(t){this.$router.push({name:"task_list",params:{isadd:!0,taskinfo:{task_host:t,task_name:["hostscan"]}}})},uploadsuccess:function(t,e){this.taskinfo=[];for(var n=0;n<t.result.length;n++)this.taskinfo.push(t.result[n].fid);this.$Message.info("上传成功。")},hostimport:function(){var t=this;o.default.ajax({method:"POST",action:"hostimport",json:{fids:this.taskinfo}}).then(function(e){t.$Message.info("后台导入中。。。")}).catch(function(e){t.$Message.error(e)})}},created:function(){if(this.$route.params.isadd)return this.modalinfo=!0;"null"!=sessionStorage.projectid&&void 0!=sessionStorage.projectid?this.hostsearch(1):(this.$Message.error("请先选择当前系统"),this.$router.push({name:"project_index"}))}}},642:function(t,e,n){n(643);var i=n(3)(n(644),n(645),"data-v-7681bee0",null);t.exports=i.exports},643:function(t,e){},644:function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(6),o=i(a),s=n(294),r=i(s);
//!/usr/bin/env nodejs
e.default={name:"tableExpand",components:{canEditTable:r.default},props:{hostid:String,hostip:String},data:function(){return{tabledata:[],columns:[{title:"服务端口",align:"center",key:"port",width:110,sortable:!0,editable:!0},{title:"服务类型",align:"center",key:"service",width:110,editable:!0},{title:"软件版本",align:"center",key:"softver",editable:!0},{title:"备注",align:"center",key:"note",editable:!0,render:function(t,e){return t("pre",{},e.row.note)}},{title:"操作",width:146,key:"handle",handle:["edit","delete"]}]}},methods:{portlistget:function(){var t=this;o.default.ajax({method:"POST",action:"portlistget",json:{hostid:this.hostid}}).then(function(e){t.tabledata=e,t.porttemp=e}).catch(function(e){t.$Message.error(e)})},portedit:function(t,e){var n=this,i=this.tabledata[e];i.hostid=this.hostid,o.default.ajax({method:"POST",action:"portedit",json:i}).then(function(e){n.$Message.info("更新成功！"),n.porttemp=t}).catch(function(t){n.$Message.error(t)})},portfinish:function(t,e){var n=this;o.default.ajax({method:"POST",action:"portfinish",json:{hostid:this.hostid,port:this.porttemp[e].port}}).then(function(e){n.$Message.info("删除成功！"),n.porttemp=t}).catch(function(t){n.$Message.error(t)})}},created:function(){this.portlistget()}}},645:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{position:"relative","z-index":"10"}},[n("can-edit-table",{ref:"selectionex",attrs:{stripe:"",border:"",id:"tableex","columns-list":t.columns},on:{"on-delete":t.portfinish,"on-change":t.portedit},model:{value:t.tabledata,callback:function(e){t.tabledata=e},expression:"tabledata"}})],1)},staticRenderFns:[]}},646:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"z-index":"1"}},[n("Modal",{attrs:{title:t.projectname,styles:{top:"30px"},okText:"导入"},on:{"on-ok":t.hostimport},model:{value:t.modalimhost,callback:function(e){t.modalimhost=e},expression:"modalimhost"}},[n("div",{staticClass:"margin-top-10"},[n("Card",[n("div",{staticClass:"height-400px"},[n("Upload",{attrs:{multiple:"",type:"drag",action:"/upload.php","on-success":t.uploadsuccess}},[n("div",{staticStyle:{padding:"60px 0",height:"200px"}},[n("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),t._v(" "),n("pre",[t._v("支持XML格式的NMAP扫描结果")])],1)])],1)])],1)]),t._v(" "),n("Card",[n("Dropdown",{staticStyle:{"margin-left":"20px"}},[n("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.modalinfo=!0}}},[n("Icon",{attrs:{type:"ios-download-outline"}}),t._v("\n                新增资产\n                ")],1),t._v(" "),n("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[n("DropdownItem",[n("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){t.modalimhost=!0}}},[n("Icon",{attrs:{type:"ios-download-outline"}}),t._v("\n                导入资产\n                ")],1)],1)],1)],1),t._v(" "),n("a",{attrs:{href:"./static/portlist.xlsx"}},[t._v("模板下载")]),t._v(" "),n("Input",{staticStyle:{width:"300px"},attrs:{slot:"extra",icon:"search",placeholder:"请输入资产IP或中间件名称进行搜索..."},on:{"on-click":function(e){t.hostsearch(1)}},nativeOn:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.hostsearch(1)}},slot:"extra",model:{value:t.searchdata,callback:function(e){t.searchdata=e},expression:"searchdata"}})],1),t._v(" "),n("can-edit-table",{ref:"selection",attrs:{stripe:"",border:"",id:"table","columns-list":t.hostcol},on:{"on-delete":t.hostfinish,"on-change":t.hostedit},model:{value:t.hostdata,callback:function(e){t.hostdata=e},expression:"hostdata"}}),t._v(" "),n("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[n("div",{staticStyle:{float:"left"}},[t._v("共 "+t._s(t.total)+" 条")]),t._v(" "),n("div",{staticStyle:{float:"right"}},[n("Page",{attrs:{"show-elevator":"",current:t.current,total:t.total,"page-size":30},on:{"on-change":t.hostsearch}})],1)]),t._v(" "),n("Modal",{attrs:{title:"新增资产",styles:{top:"30px"},okText:"保存"},on:{"on-ok":t.portadd},model:{value:t.modalinfo,callback:function(e){t.modalinfo=e},expression:"modalinfo"}},[n("Form",{attrs:{inline:"","label-width":80}},[n("FormItem",{attrs:{label:"系统地址"}},[n("Input",{attrs:{type:"text",placeholder:"必填 127.0.0.1"},model:{value:t.addinfo.hostip,callback:function(e){t.$set(t.addinfo,"hostip",e)},expression:"addinfo.hostip"}})],1),t._v(" "),n("FormItem",{attrs:{label:"服务端口"}},[n("InputNumber",{attrs:{max:65535,min:1,placeholder:"必填 80"},model:{value:t.addinfo.hostport,callback:function(e){t.$set(t.addinfo,"hostport",e)},expression:"addinfo.hostport"}})],1)],1),n("Form",{attrs:{inline:"","label-width":80}},[n("FormItem",{attrs:{label:"主机名称"}},[n("Input",{attrs:{type:"text",placeholder:"window/linux"},model:{value:t.addinfo.hostname,callback:function(e){t.$set(t.addinfo,"hostname",e)},expression:"addinfo.hostname"}})],1),t._v(" "),n("FormItem",{attrs:{label:"服务类型"}},[n("Input",{attrs:{type:"text",placeholder:"http/dns/mysql"},model:{value:t.addinfo.service,callback:function(e){t.$set(t.addinfo,"service",e)},expression:"addinfo.service"}})],1)],1),n("Form",{attrs:{inline:"","label-width":80}},[n("FormItem",{attrs:{label:"系统版本"}},[n("Input",{attrs:{type:"text",placeholder:"window7/centos6"},model:{value:t.addinfo.osver,callback:function(e){t.$set(t.addinfo,"osver",e)},expression:"addinfo.osver"}})],1),t._v(" "),n("FormItem",{attrs:{label:"软件版本"}},[n("Input",{attrs:{type:"text",placeholder:"iis6.0/mysql5.8"},model:{value:t.addinfo.softver,callback:function(e){t.$set(t.addinfo,"softver",e)},expression:"addinfo.softver"}})],1)],1),n("Form",{attrs:{"label-width":80}},[n("FormItem",{attrs:{label:"备注"}},[n("Input",{attrs:{type:"textarea"},model:{value:t.addinfo.note,callback:function(e){t.$set(t.addinfo,"note",e)},expression:"addinfo.note"}})],1)],1)],1)],1)},staticRenderFns:[]}}});